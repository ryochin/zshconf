#

echo "Loading $HOME/.zsh/zshrc.user"

# system
#umask 027

# env
export CVSROOT=$HOME/cvs
export SVNROOT=$HOME/svn
export ACK_COLOR_MATCH='underline white'
export GZIP='-v9N'

# lang
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export LC_CTYPE=en_US.UTF-8
#export LANG=ja_JP.UTF-8
#export LC_CTYPE=ja_JP.UTF-8

# mail
if [ $UID = 0 ]; then
    MAILDIR=/var/qmail/alias/Maildir; export MAILDIR
else
    MAILDIR=$HOME/Maildir; export MAILDIR
fi

# ec2
export JAVA_HOME=/usr/java
export EC2_HOME=/usr/local/ec2/apitools
export PATH=$PATH:$EC2_HOME/bin
export EC2_PRIVATE_KEY=~/.ec2/pk-xxxxxxxx.pem
export EC2_CERT=~/.ec2/cert-xxxxxxxx.pem

# mysql prompt
export MYSQL_PS1="\u@`hostname -s`[\d]> "

# default function
function chpwd() { ls -lF }

# editor
if [ -x /usr/bin/ee ]; then
    export EDITOR=ee
else
    export EDITOR=vi
    alias ee='nano -w'
fi

# pager
export LESSCHARSET=
if [ -x /usr/local/bin/lv ]; then
    export PAGER="lv"
elif [ -x /usr/local/bin/jless ]; then
    export PAGER=jless
else
    export PAGER=less
fi

# ls
alias l='ls -lFAo'
alias lr='ls -RF'
alias lf='ls -AF'
alias lt='ls -lFAot'
alias ltr='ls -lFAotr'
alias lss='ls -lF | sort -n +4'
alias lssr='ls -lF | sort -nr +4'
alias d=dir

# svn
export SVN_EDITOR=$EDITOR
alias ss='svn status'
alias sd='svn diff'
alias svn-addprops="svn propset svn:keywords 'Date Author URL Id Revision'"

# command
alias g='grep'
alias psg=psgrep
alias lg=lsgrep
alias ns=netstat
alias ng=netgrep
alias av=asciiview
alias mv='mv -i'
alias c=cat
alias h=head
alias j='jobs -l'
alias n=nmore
alias s=sort
alias t=tail
alias m=$PAGER

# alias
alias root='su -l'
alias tm=tmore

# add options
alias gg='grep -an -B 5 -A 5'
alias tt='tail -36'
alias pa='ps -aux'
alias ping='ping -c 5'
alias ftp='ncftp -L'
alias cdcontrol='cdcontrol -f /dev/acd0a'
alias lock='lock -np'
alias ntop='ntop -r1 -n'
#alias trafshow='trafshow -r1 -n'

# perl
alias pd=perldoc
alias pdm='perldoc -m'
alias pdl='perldoc -l'

# utils
alias null='cat /dev/null >'
alias gd='dirs -v; echo -n "select number: " ; read newdir; cd -"$newdir"'
alias files='file ./* | egrep -v "(empty|directory|symbolic|Permission denied)" '
alias xmllint_html='xmllint --html --noout'
alias iccenv='AR=xiar CC=icc CXX=icpc CFLAGS="-O3 -unroll4 -ipo -fp-model precise -no-gcc -restrict -xSSSE3" CXXFLAGS="-O3 -unroll4 -ipo -fp-model precise -no-gcc -restrict -xSSSE3"'

# read-only
#alias mutt='mutt -R'

#
compctl -f -x 'p[1,2]' -g "*(-/) *.(gz|bz2|tgz|tbz2*|zip)"        -- extract

# print help for me.
function help(){
	echo "
< zsh command help for me :-) >
 ^A	move cursor to the head of the sentense
 ^E	move cursor to the tail of the sentense

 ^B	move cursor to back word
 ^F	move cursor to next word

 ^K	delete right to cursor
 ^U	delete left to cursor

 ^L	clear screen
 ^T	replace to the before charactor
 ^I	complation (=tab)

 ^G	cancel command

 ^R	history search (backward)

 ^W	copy & remove this line
 ^Y	paste

 ^Q	commandline stacking

 ^J	return??
 ^M	return??

 ^N	??
 ^O	??

- std

 ^H	delete one char
 ^Z	sunpend process (or change screen)
 ^D	logout
	"
}

# see bash-prompt howto.
function jobcount() {
#        jobs|wc -l| awk '{print $1}'
	echo -n `jobs | wc -l | awk '{print $1}'`
}

# set prompt
function prompt() {
    case $1 in
	1) PROMPT="%n@%l'%m:%~%# " ;;  # default
        2) PROMPT='%n@%m:%# ' ;;    # pwd simple mode
	3) PROMPT='$ ' ;;
	4) PROMPT='%n@%m %# ' ;;
	5) PROMPT="%n@%l'%U%m%u[`jobcount`]:%4~%# " ;;
	*) PROMPT="$PROMPT_DEFAULT" ;;
    esac
}

function rprompt() {
    case $1 in
	0) RPROMPT='' ;;   # nothing
	1) RPROMPT='%B[%(?.%!.ERROR:%?)] (%U%D%u %D{%a %H:%M:%S %p})%b' ;;
	2) RPROMPT='%B(%D %D{%a %H:%M:%S})%b' ;;
	3) RPROMPT='%D{%H:%M:%S %p}' ;;
	4) RPROMPT='[%(?.%!.ERR:%?)] %D{%H:%M:%S %p}' ;;
        5) RPROMPT='[%~] %D{%H:%M:%S %p}' ;;
	*) RPROMPT="$RPROMPT_DEFAULT" ;;
    esac
}

functions crontab () {
	if  [ $1 = -r ]; then
		echo -n "Are you sure to delete your crontab ? [y/n] "
		read ANSWER
		case "$ANSWER" in
			y | yes ) command crontab "$1" && echo "deleted." ;;
		esac
	else
		command crontab "$1"
	fi
}

#function precmd () {
#  epoch=`date "+%s"`   
#  if [ `expr $epoch % 3` != 0 ]; then 
#    return
#  fi
#
#  load=`uptime | sed -e 's/.*: \([^, ]*\).*/\1/'`
#  if [ $load -gt 2.0 ]; then
#    echo "zsh: load avg is $load !"
#  fi  
#}

function sethome() {
	export MYHOME=`pwd`
	echo "home: ${MYHOME}"
}

function gohome() {
	chdir $MYHOME
}

function load-git-config() {
	source ~/.zsh/zshrc.user.git
}
